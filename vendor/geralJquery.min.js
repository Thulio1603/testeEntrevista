$(document).ready(function(){
    $("#inserirCliente").hide();
    $("#pesquisarCliente").hide();
    $("#alterarCliente").hide();
    $("#deletarCliente").hide();
    $("#inserirProdutos").hide();
    $("#pesquisarProdutos").hide();
    $("#alterarProdutos").hide();
    $("#deletarProdutos").hide();
    $("#inserirPedidos").hide();
    $("#pesquisarPedidos").hide();
    $("#alterarPedidos").hide();
    $("#deletarPedidos").hide();
      //escondendo contaúdo para melhor interação
      
    $("#containerCliente").hide();
    $("#containerProdutos").hide();
    $("#containerPedidos").hide();
    $("#table").hide();
   $("#cliente").click(function(){
      $("#bemvindo").hide();
      $("#containerPedidos").hide();
      $("#containerProdutos").hide();  
      $("#containerCliente").show(); 
   });
   $("#produto").click(function(){
      $("#bemvindo").hide();  
      $("#containerPedidos").hide();
      $("#containerProdutos").show();  
      $("#containerCliente").hide(); 
   });
   $("#pedido").click(function(){
      $("#bemvindo").hide();  
      $("#containerPedidos").show();
      $("#containerProdutos").hide();  

      $("#containerCliente").hide(); 
   });
   
   $("#subInserirC").click(function(){
        // aplicando mascara
        $("#telefoneI").mask('(99) 99999-9999');
        
       $("#inserirCliente").show();
       $("#pesquisarCliente").hide();
       $("#alterarCliente").hide();
       $("#deletarCliente").hide();
   });
   $("#subProcurarC").click(function(){
       $("#inserirCliente").hide();
       $("#pesquisarCliente").show();
       $("#alterarCliente").hide();
       $("#deletarCliente").hide();
   });
   $("#subAlterarC").click(function(){
        // aplicando mascara
        $("#telefoneA").mask('(99) 99999-9999');
        
       $("#inserirCliente").hide();
       $("#pesquisarCliente").hide();
       $("#alterarCliente").show();
       $("#deletarCliente").hide();
   });
   $("#subDeletarC").click(function(){
       $("#inserirCliente").hide();
       $("#pesquisarCliente").hide();
       $("#alterarCliente").hide();
       $("#deletarCliente").show();
   });
   
   $("#subInserirProd").click(function(){
        // aplicando mascara
        $("#precoProdutoI").maskMoney();
        
        $("#inserirProdutos").show();
        $("#pesquisarProdutos").hide();
        $("#alterarProdutos").hide();
        $("#deletarProdutos").hide();
   });
   $("#subProcurarProd").click(function(){
        $("#inserirProdutos").hide();
        $("#pesquisarProdutos").show();
        $("#alterarProdutos").hide();
        $("#deletarProdutos").hide();
   });
   $("#subAlterarProd").click(function(){
        // aplicando mascara
        $("#precoProdutoA").maskMoney();
        
        $("#inserirProdutos").hide();
        $("#pesquisarProdutos").hide();
        $("#alterarProdutos").show();
        $("#deletarProdutos").hide();
   });
   $("#subDeletarProd").click(function(){
        $("#inserirProdutos").hide();
        $("#pesquisarProdutos").hide();
        $("#alterarProdutos").hide();
        $("#deletarProdutos").show();
   });
   
   $("#subInserirPed").click(function(){
        // aplicando mascara
        $("#dataI").mask('99/99/9999');
        $("#qtdeI").mask('9999999');
        
        $("#inserirPedidos").show();
        $("#pesquisarPedidos").hide();
        $("#alterarPedidos").hide();
        $("#deletarPedidos").hide();
   });
   $("#subProcurarPed").click(function(){
        $("#inserirPedidos").hide();
        $("#pesquisarPedidos").show();
        $("#alterarPedidos").hide();
        $("#deletarPedidos").hide();
   });
   $("#subAlterarPed").click(function(){
        // aplicando mascara
        $("#dataA").mask('99/99/9999');
        $("#qtdeA").mask('9999999');
        
        $("#inserirPedidos").hide();
        $("#pesquisarPedidos").hide();
        $("#alterarPedidos").show();
        $("#deletarPedidos").hide();
   });
   $("#subDeletarPed").click(function(){
        $("#inserirPedidos").hide();
        $("#pesquisarPedidos").hide();
        $("#alterarPedidos").hide();
        $("#deletarPedidos").show();
   });  
   //menu de seleção
   

   
   //requisições para a inserção, deleção, alteração e seleção de cadastro
   
   // CLIENTE
   $("#buttonPesquisa").click(function(){
         if(($("#nomeP").val() != null || $("#emailP").val() != null) && ($("#nomeP").val() != '' || $("#emailP").val() != '') ){
            $.ajax({
                url : "../controller/usuarioController.php",
                type : 'post',
                data : {
                    tipo: 'pesquisa',
                    tipo2: 'cliente',
                    nome : $("#nomeP").val(),
                    email : $("#emailP").val()
                },
                success: function(data) {
                    if(data != 0){
                        data = data.split(',');
                        for(var i = 0; i < data.length; i++){
                            $("#linhaTable"+i).remove();
                            if(data[i] != '"' && data[i] != '' && data[i] != null ){
                                $("#tableCliente").append("<tr id='linhaTable"+i+"'><td>"+data[i].replace('"', '')+"</td> <td>"+data[i+1].replace('"', '')+"</td> <td>"+data[i+2].replace('"', '')+"</td> </tr");
                                i = 3;
                            }
                        }
                        $("#table").show();
                    }else{
                        alert("Não obtivemos nenhum retorno, verifique se os dados conferem com o banco");
                    }
                },
            })
        }else{
            alert('Preencha ao menos um campo para pesquisar');
        }
   });
   $("#buttonInserir").click(function(){
    if(($("#nomeI").val() != null && $("#emailI").val() != null && $("#telefoneI").val() != null) && ($("#nomeI").val() != '' && $("#emailI").val() != '' && $("#telefoneI").val() != '') ){
        $.ajax({
            url : "../controller/usuarioController.php",
            type : 'post',
            data : {
                tipo: 'insercao',
                tipo2: 'cliente',                
                nome : $("#nomeI").val(),
                email : $("#emailI").val(),
                telefone: $("#telefoneI").val()
            },
            success: function(data) {
                console.log(data);
                if(data == 1){
                    alert('Inserido com sucesso');
                }else if(data == 0){
                    alert('Não foi possível realizar a ação, verifique se os dados conferem com o banco');
                }
            },
        })
    }else{
        alert('nenhum campo pode ficar vazio');
    }
   });
   $("#buttonAlterar").click(function(){
    if(($("#nomeA").val() != null && $("#emailA").val() != null && $("#telefoneA").val() != null) && ($("#nomeA").val() != '' && $("#emailA").val() != '' && $("#telefoneA").val() != '') ){
        $.ajax({
            url : "../controller/usuarioController.php",
            type : 'post',
            data : {
                tipo: 'alteracao',
                tipo2: 'cliente',
                nome : $("#nomeA").val(),
                email : $("#emailA").val(),
                telefone: $("#telefoneA").val(),
                alterado: $("#nomePesquisa").val(),
            },
            success: function(data) {
                console.log(data);
                if(data == 1){
                    alert('Alterado com sucesso');
                }else if(data == 0){
                    alert('Não foi possível realizar a ação, verifique se os dados conferem com o banco');
                }
            },
        })
    }else{
        alert('nenhum campo pode ficar vazio');
    }
   });
   $("#buttonDeletar").click(function(){
    if(($("#nomeD").val() != null) && ($("#nomeD").val() != '') ){
        $.ajax({
            url : "../controller/usuarioController.php",
            type : 'post',
            data : {
                tipo: 'delecao',
                tipo2: 'cliente',
                nome : $("#nomeD").val(),
                email : $("#emailD").val()
            },
            success: function(data) {
                console.log(data);
                if(data == 1){
                    alert('Deletado com sucesso');
                }else if(data == 0){
                    alert('Não foi possível realizar a ação, verifique se os dados conferem com o banco');
                }
            },
        })
    }else{
        alert('nenhum campo pode ficar vazio');
    }
   });
   
   // PRODUTO
    $("#buttonPesquisaProduto").click(function(){
     if(($("#nomeProdutoP").val() != null || $("#descricaoProdutoP").val() != null) && ($("#nomeProdutoP").val() != '' || $("#descricaoProdutoP").val() != '') ){
        $.ajax({
            url : "../controller/usuarioController.php",
            type : 'post',
            data : {
                tipo: 'pesquisa',
                tipo2: 'produto',
                nome : $("#nomeProdutoP").val(),
                descricao : $("#descricaoProdutoP").val()
            },
            success: function(data) {
                if(data != 0){
                    data = data.split(',');
                    for(var i = 0; i < data.length; i++){
                        if(data[i] != '"' && data[i] != '' && data[i] != null ){
                            $("#linhaTable"+i).remove();
                            $("#tableProduto").append("<tr id='linhaTable"+i+"'><td>"+data[i].replace('"', '')+"</td> <td>"+data[i+1].replace('"', '')+"</td> <td>"+data[i+2].replace('"', '')+"</td> </tr");
                            i = 3;
                        }
                    }
                    $("#table").show();
                }else{
                    alert("Não obtivemos nenhum retorno, verifique se os dados conferem com o banco");
                }
            },
        })
    }else{
        alert('Preencha ao menos um campo para pesquisar');
    }
   });
   $("#buttonInserirProduto").click(function(){
    if(($("#nomeProdutoI").val() != null && $("#descricaoProdutoI").val() != null && $("#precoProdutoI").val() != null) && ($("#nomeProdutoI").val() != '' && $("#descricaoProdutoI").val() != '' && $("#precoProdutoI").val() != '') ){
        $.ajax({
            url : "../controller/usuarioController.php",
            type : 'post',
            data : {
                tipo: 'insercao',
                tipo2: 'produto',
                nome : $("#nomeProdutoI").val(),
                descricao : $("#descricaoProdutoI").val(),
                preco: $("#precoProdutoI").val()
            },
            success: function(data) {
                console.log(data);
                if(data == 1){
                    alert('Inserido com sucesso');
                }else if(data == 0){
                    alert('Não foi possível realizar a ação, verifique se os dados conferem com o banco');
                }
            },
        })
    }else{
        alert('nenhum campo pode ficar vazio');
    }
   });
   $("#buttonAlterarProduto").click(function(){
    if(($("#nomeProdutoA").val() != null && $("#descricaoProdutoA").val() != null && $("#precoProdutoA").val() != null) && ($("#nomeProdutoA").val() != '' && $("#descricaoProdutoA").val() != '' && $("#precoProdutoA").val() != '') ){
        $.ajax({
            url : "../controller/usuarioController.php",
            type : 'post',
            data : {
                tipo: 'alteracao',
                tipo2: 'produto',
                nome : $("#nomeProdutoA").val(),
                descricao : $("#descricaoProdutoA").val(),
                preco: $("#precoProdutoA").val(),
                alterado: $("#nomePesquisaProd").val(),
            },
            success: function(data) {
                console.log(data);
                if(data == 1){
                    alert('Alterado com sucesso');
                }else if(data == 0){
                    alert('Não foi possível realizar a ação, verifique se os dados conferem com o banco');
                }
            },
        })
    }else{
        alert('nenhum campo pode ficar vazio');
    }
   });
   $("#buttonDeletarProduto").click(function(){
        if(($("#nomeProdutoD").val() != null) && ($("#nomeProdutoD").val() != '') ){
            $.ajax({
                url : "../controller/usuarioController.php",
                type : 'post',
                data : {
                    tipo: 'delecao',
                    tipo2: 'produto',
                    nome : $("#nomeProdutoD").val(),
                    email : $("#emailD").val()
                },
                success: function(data) {
                    console.log(data);
                    if(data == 1){
                        alert('Deletado com sucesso');
                    }else if(data == 0){
                        alert('Não foi possível realizar a ação, verifique se os dados conferem com o banco');
                    }
                },
            })
        }else{
            alert('nenhum campo pode ficar vazio');
        }
   });
   
   $("#buttonInserirPedido").click(function(){
        if(($("#dataI").val() != null && $("#clienteI").val() != null && $("#produtoI").val() != null && $("#qtdeI").val() != null) && ($("#dataI").val() != '' && $("#clienteI").val() != '' && $("#produtoI").val() != '' && $("#qtdeI").val() != '') ){
            $.ajax({
                url : "../controller/usuarioController.php",
                type : 'post',
                data : {
                    tipo: 'insercao',
                    tipo2: 'pedido',
                    data1 : $("#dataI").val(),
                    cliente : $("#clienteI").val(),
                    produto: $("#produtoI").val(),
                    qtde: $("#qtdeI").val(),
                    alterado: $("#nomePesquisa").val()
                },
                success: function(data) {
                    console.log(data);
                    if(data == 1){
                        alert('Inserido com sucesso');
                    }else if(data == 0){
                        alert('Não foi possível realizar a ação, verifique se os dados conferem com o banco');s
                    }
                },
            })
        }else{
            alert('nenhum campo pode ficar vazio');
        }
   });
    $("#buttonPesquisaPedido").click(function(){
        if(($("#clienteP").val() != null || $("#produtop").val() != null) && ($("#clienteP").val() != '' || $("#produtop").val() != '') ){
        $.ajax({
            url : "../controller/usuarioController.php",
            type : 'post',
            data : {
                tipo: 'pesquisa',
                tipo2: 'pedido',
                cliente: $("#clienteP").val(),
                produto: $("#produtop").val(),
            },
            success: function(data) {
                if(data != 0){
                    data = data.split(',');
                    console.log(data);
                    var i = 0;
                    console.log('tamanho: '+data.length);
                    for(var y = 0; y <= data.length; y++){
                        $("#linhaTable"+y).remove();
                    }
                    while( i < data.length - 1 ){
                        if(data[0] != '"' && data[0] != '' && data[0] != null ){
                            $("#tablePed").append("<tr id='linhaTable"+i+"'><td>"+data[i].replace('"', '')+"</td> <td>"+data[i+1]+"</td> <td>"+data[i+2]+"</td> <td>"+data [i+3]+"</td> </tr");
                            i += 4;
                        }
                    }
                    $("#table").show();
                }else{
                    alert("Não obtivemos nenhum retorno, verifique se os dados conferem com o banco");
                }
            },
        })
        }else{
            alert('Preencha ao menos um campo para pesquisar');
        }
   });
   
    $("#buttonAlterarPedido").click(function(){
        if(($("#clienteA").val() != null && $("#produtoA").val() != null && $("#qtdeA").val() != null) && ($("#clienteA").val() != '' && $("#produtoA").val() != '' && $("#qtdeA").val() != '') ){
            $.ajax({
                url : "../controller/usuarioController.php",
                type : 'post',
                data : {
                    tipo: 'alteracao',
                    tipo2: 'pedido',
                    cliente : $("#clienteA").val(),
                    produto : $("#produtoA").val(),
                    qtde: $("#qtdeA").val(),
                    data : $("#dataA").val(),
                    alterado: $("#nomePesquisaPed").val(),
                },
                success: function(data) {
                    console.log(data);
                    if(data == 1){
                        alert('Alterado com sucesso');
                    }else if(data == 0){
                        alert('Não foi possível realizar a ação, verifique se os dados conferem com o banco');
                    }
                },
            })
        }else{
            alert('nenhum campo pode ficar vazio');
        }
   });
    $("#buttonDeletarPedido").click(function(){
        if(($("#nomeDelet").val() != null) && ($("#nomeDelet").val() != '') ){
            $.ajax({
                url : "../controller/usuarioController.php",
                type : 'post',
                data : {
                    tipo: 'delecao',
                    tipo2: 'pedido',
                    cliente : $("#nomeDelet").val(),
                },
                success: function(data) {
                    console.log(data);
                    if(data == 1){
                        alert('Deletado com sucesso');
                    }else if(data == 0){
                        alert('Não foi possível realizar a ação, possivelmente o cliente não tem pedido cadastrado');
                    }
                },
            })
        }else{
            alert('nenhum campo pode ficar vazio');
        }
   });
   // ajax para preencher o select dos pedidos
   $.ajax({
        url : "../controller/usuarioController.php",
        type : 'post',
        data : {
            tipo: 'select',
            nome : $("#nomeProdutoP").val(),
            descricao : $("#descricaoProdutoP").val()
        },
        success: function(data) {
            if(data != 0){
                //console.log(data);
                var cliente = data;
                var aux = 0; 
                var apoio = 1;
                cliente = cliente.split(',');
                
                for(var i = 0; i <= cliente.length; i++){
                    if(cliente[i] != '' && cliente[i] != null && cliente[i] != ' '){
                        //cliente[i] = cliente[i].replace('"', '');
                        console.log(cliente[i][1]+'  ,  '+cliente[i] + i);
                        
                        if(cliente[i][1] == '#' || cliente[i][1] == '&' ){
                            if(cliente[i][1] == '#'){
                                aux++
                                clienteFinal = cliente[i].replace('"', '');
                                clienteFinal = clienteFinal.replace('#','');
                                //preenchendo os options dos selects
                                $('#clienteI').append('<option id="'+aux+'cli">' + clienteFinal + '</option>');
                                $('#clienteP').append('<option id="'+aux+'cliP">' + clienteFinal + '</option>');
                                $('#nomePesquisaPed').append('<option id="'+aux+'cliPesquisa">' + clienteFinal + '</option>');
                                $('#clienteA').append('<option id="'+aux+'cliAltera">' + clienteFinal + '</option>');
                                $('#nomeDelet').append('<option id="'+aux+'cliDelet">' + clienteFinal + '</option>');
                            }else{
                                clienteFinal = cliente[i].replace('"', '');
                                clienteFinal = clienteFinal.replace('&', '');
                                $('#'+apoio+'cli').val(clienteFinal);
                                $('#'+apoio+'cliP').val(clienteFinal);
                                $('#'+apoio+'cliPesquisa').val(clienteFinal);
                                $('#'+apoio+'cliAltera').val(clienteFinal);
                                $('#'+apoio+'cliDelet').val(clienteFinal);
                                apoio++;
                            }
                        }else if(cliente[i][1] == '@'  || cliente[i][1] == '*'){
                            if(cliente[i][1] == '@'){
                                aux++;
                                clienteFinal = cliente[i].replace('"', '');
                                clienteFinal = clienteFinal.replace('@', '');
                                $('#produtoI').append('<option id="'+aux+'prod">' + clienteFinal + '</option>');
                                $('#produtop').append('<option id="'+aux+'prodP">' + clienteFinal + '</option>');
                                $('#produtoA').append('<option id="'+aux+'prodAltera">' + clienteFinal + '</option>');
                            }else{
                                if(apoio <= aux){
                                    clienteFinal = cliente[i].replace('"', '');
                                    clienteFinal = clienteFinal.replace('*', '');
                                    $('#'+apoio+'prod').val(clienteFinal);
                                    $('#'+apoio+'prodP').val(clienteFinal);
                                    $('#'+apoio+'prodAltera').val(clienteFinal);
                                    apoio++;
                                }
                            }
                        }
                    }
                }
                $("#table").show();
            }
        },
    });
});
